
@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    @*<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">*@
    @*<link href="~/Theame/css/style.css" rel="stylesheet" asp-append-version="true" />*@
    <style>
        .pageloader {
            position: fixed;
            left: 0px;
            top: 0px;
            width: 100%;
            height: 100%;
            z-index: 9999;
            background: url('/Theame/images/loader.gif') 50% 50% no-repeat rgb(249, 249, 249);
            opacity: .8;
        }
    </style>
</head>
<body>
    <input type="hidden" id="ApplicationId" value="@ViewBag.AppId" />
    <input type="hidden" id="UserId" value="@ViewBag.UserId" />
    <input type="hidden" id="Mcrcmember1UserId" value="@ViewBag.UserId1" />
    <input type="hidden" id="Mcrcmember2UserId" value="@ViewBag.UserId2" />
    <input type="hidden" id="Mcrcmember3UserId" value="@ViewBag.UserId3" />
    <input type="hidden" id="Mcrcmember4UserId" value="@ViewBag.UserId4" />
    <input type="hidden" id="Mcrcmember5UserId" value="@ViewBag.UserId5" />

    <div class="tab_content" style="padding: 15px 20px">
        <div class="row">
            <div class="pageloader d-none"></div>


            <div class="col-md-4">
                <p class="detailHeading">
                    Client ID
                </p>
                <p class="detailText">@ViewBag.ClientId</p>
            </div>
            <div class="col-md-4">
            </div>
            <div class="col-md-4">
                <p class="detailHeading">
                    Mcrc ID
                </p>
                <p class="detailText">@ViewBag.McrcNo</p>
            </div>
            <div class="col-md-4">
                <p class="detailHeading">
                    APPLICANT / RESPONDENT NAME
                </p>
                <p class="detailText">@ViewBag.ApplicantName</p>
            </div>
            <div class="col-md-4">
                <p class="detailHeading">
                    CLIENT / SCHOOL / BUSINESS NAME
                </p>
                <p class="detailText">@ViewBag.SchoolName</p>
            </div>
            <div class="col-md-4">
                <p class="detailHeading">
                    CNIC No.
                </p>
                <p class="detailText">@ViewBag.Cnic</p>
            </div>

            @if (ViewBag.UserId1 != 0)
            {
                <div class="col-md-4">
                    <p class="detailHeading">
                        Mcrc Member 1 Name
                    </p>
                    <p class="detailText">@ViewBag.McrcMember1Name</p>
                </div>
                <div class="col-md-4">
                    <p class="detailHeading">
                        Mcrc Member 1 Recommendation
                    </p>
                    <select class="form-control" id="McrcMember1Recommendation">
                        <option value="">Select Decision</option>
                        <option value="Approve">Recommend</option>
                        <option value="Decline">Decline</option>
                        <option value="Discrepent">Discrepent</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <p class="detailHeading">
                        If Discrepant/Decline, Reason
                    </p>
                    @*<p class="detailText">@(ViewBag.McrcMember1Reason == null || ViewBag.McrcMember1Reason == "" ? "--" : ViewBag.McrcMember1Reason )</p>*@
                    <input type="text" class="form-control" id="McrcMember1Reason" />
                </div>
            }
            @if (ViewBag.UserId2 != 0)
            {


                <div class="col-md-4">
                    <p class="detailHeading">
                        Mcrc Member 2 Name
                    </p>
                    <p class="detailText">@ViewBag.McrcMember2Name</p>
                </div>
                <div class="col-md-4">
                    <p class="detailHeading">
                        Mcrc Member 2 Recommendation
                    </p>
                    <select class="form-control" id="McrcMember2Recommendation">
                        <option value="">Select Decision</option>
                        <option value="Approve">Recommend</option>
                        <option value="Decline">Decline</option>
                        <option value="Discrepent">Discrepent</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <p class="detailHeading">
                        If Discrepant/Decline, Reason
                    </p>
                    @*<p class="detailText">@(ViewBag.McrcMember2Reason == null || ViewBag.McrcMember2Reason == "" ? "--" : ViewBag.McrcMember2Reason )</p>*@
                    <input type="text" class="form-control" id="McrcMember2Reason" />
                </div>
            }
            @if (ViewBag.UserId3 != 0)
            {
                <div class="col-md-4">
                    <p class="detailHeading">
                        Mcrc Member 3 Name
                    </p>
                    <p class="detailText">@ViewBag.McrcMember3Name</p>
                </div>
                <div class="col-md-4">
                    <p class="detailHeading">
                        Mcrc Member 3 Recommendation
                    </p>
                    <select class="form-control" id="McrcMember3Recommendation">
                        <option value="">Select Decision</option>
                        <option value="Approve">Recommend</option>
                        <option value="Decline">Decline</option>
                        <option value="Discrepent">Discrepent</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <p class="detailHeading">
                        If Discrepant/Decline, Reason
                    </p>
                    @*<p class="detailText">@(ViewBag.McrcMember3Reason==null || ViewBag.McrcMember3Reason == "" ? "--" : ViewBag.McrcMember3Reason )</p>*@
                    <input type="text" class="form-control" id="McrcMember3Reason" />
                </div>
            }
            @if (ViewBag.UserId4 != 0)
            {
                <div class="col-md-4">
                    <p class="detailHeading">
                        Mcrc Member 4 Name
                    </p>
                    <p class="detailText">@ViewBag.McrcMember4Name</p>
                </div>
                <div class="col-md-4">
                    <p class="detailHeading">
                        Mcrc Member 4 Recommendation
                    </p>
                    <select class="form-control" id="McrcMember4Recommendation">
                        <option value="">Select Decision</option>
                        <option value="Approve">Recommend</option>
                        <option value="Decline">Decline</option>
                        <option value="Discrepent">Discrepent</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <p class="detailHeading">
                        If Discrepant/Decline, Reason
                    </p>
                    @*<p class="detailText">@(ViewBag.McrcMember3Reason==null || ViewBag.McrcMember3Reason == "" ? "--" : ViewBag.McrcMember3Reason )</p>*@
                    <input type="text" class="form-control" id="McrcMember4Reason" />
                </div>
            }
            @if (ViewBag.UserId5 != 0)
            {
                <div class="col-md-4">
                    <p class="detailHeading">
                        Mcrc Member 5 Name
                    </p>
                    <p class="detailText">@ViewBag.McrcMember5Name</p>
                </div>
                <div class="col-md-4">
                    <p class="detailHeading">
                        Mcrc Member 5 Recommendation
                    </p>
                    <select class="form-control" id="McrcMember5Recommendation">
                        <option value="">Select Decision</option>
                        <option value="Approve">Recommend</option>
                        <option value="Decline">Decline</option>
                        <option value="Discrepent">Discrepent</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <p class="detailHeading">
                        If Discrepant/Decline, Reason
                    </p>
                    <input type="text" class="form-control" id="McrcMember5Reason" />

                    @*<p class="detailText">@(ViewBag.McrcMember3Reason==null || ViewBag.McrcMember3Reason == "" ? "--" : ViewBag.McrcMember3Reason )</p>*@
                </div>
            }

            <div class="col-md-4">
                <p class="detailHeading">
                    Decision of Mcrc
                </p>
                <select class="form-control" id="Decision">
                    <option value="">Select Decision</option>
                    <option value="Approve">Recommend</option>
                    <option value="Decline">Decline</option>
                    <option value="Discrepent">Discrepent</option>
                    <option value="Discrepent & Represent">Discrepent & Represent</option>
                </select>
            </div>

            <div class="col-md-8  d-none" id="reasonDiv">
                <p class="detailHeading">
                    If Discrepant/Decline, Reason
                </p>
                <input type="text" class="form-control" id="Reason" />
            </div>

        </div>
        <div class="row d-none" id="approvalDiv">
            <div class="col-md-4">
                <p class="detailHeading">
                    Loan Amount
                </p>
                <input type="text" class="form-control" id="txtloanAmount" value="@ViewBag.LoanAmount" disabled />
            </div>
            <div class="col-md-4">
                <p class="detailHeading">
                    Loan Tenure
                </p>
                <input type="text" class="form-control" id="txtloanTenure" value="@ViewBag.LoanTenure" disabled />
            </div>
            <div class="col-md-4 d-none">
                <p class="detailHeading">
                    Grace Days (First Instalment)
                </p>
                <input type="number" min="0" max="1000" class="form-control" id="txtGraceDays" value="0" />
            </div>
            <div class="col-md-4">
                <p class="detailHeading">
                    Applied Mark-up Rate
                </p>
                <input type="text" class="form-control" id="txtMarkup" value="@ViewBag.Mark_Up" disabled />
            </div>
            <div class="col-md-4">
                <p class="detailHeading">
                    Collateral Amount
                </p>
                <input type="text" class="form-control" id="txtCollateralAmount" value="@ViewBag.CollateralAmount" disabled />
            </div>
            <div class="col-md-4">
                <p class="detailHeading">
                    LTV %
                </p>
                <input type="text" class="form-control" id="txtLTVpercentage" value="@ViewBag.LTVPercentage" disabled />
            </div>
            <div class="col-md-4">
                <p class="detailHeading">
                    Collateral Evaluation Date
                </p>
                <input type="text" class="form-control" id="txtCollateralEvaluationDate" value="@ViewBag.cDate" disabled />
            </div>
            <div class="col-md-4">
                <p class="detailHeading">
                    Deferment Applied
                </p>
                <select class="form-control" id="isDeferment">
                    <option value="">Select</option>
                    <option value="Yes">Yes</option>
                    <option value="No">No</option>
                </select>
            </div>
            <div class="col-md-4">
                <p class="detailHeading">
                    Deferment Period (Months)
                </p>
                <input type="number" min="0" max="1000" class="form-control" id="txtDefermentPeriod" value="" />
            </div>
            <div class="col-md-4"></div>
            <div class="col-md-4">
                <p class="detailHeading">
                    Tranches Applied
                </p>
                <select class="form-control" id="isTranches">
                    <option value="">Select</option>
                    <option value="Yes">Yes</option>
                    <option value="No">No</option>
                </select>
            </div>
            <div class="col-md-4">
                <p class="detailHeading">
                    Tranches Amounts
                </p>
                <input type="text" class="form-control" id="txtTranchesAmounts" />
            </div>
            <div class="col-md-12">
                <p class="detailHeading">
                    Tranches Dates
                </p>
                <div class="form-check">
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="checkbox" id="inlineCheckbox1" name="tranchDate" value="January">
                        <label class="form-check-label" for="inlineCheckbox1">Jan</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="checkbox" id="inlineCheckbox2" name="tranchDate" value="February">
                        <label class="form-check-label" for="inlineCheckbox2">Feb</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="checkbox" id="inlineCheckbox3" name="tranchDate" value="March">
                        <label class="form-check-label" for="inlineCheckbox3">Mar</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="checkbox" id="inlineCheckbox4" name="tranchDate" value="April">
                        <label class="form-check-label" for="inlineCheckbox4">Apr</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="checkbox" id="inlineCheckbox5" name="tranchDate" value="May">
                        <label class="form-check-label" for="inlineCheckbox5">May</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="checkbox" id="inlineCheckbox6" name="tranchDate" value="June">
                        <label class="form-check-label" for="inlineCheckbox6">Jun</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="checkbox" id="inlineCheckbox7" name="tranchDate" value="July">
                        <label class="form-check-label" for="inlineCheckbox7">Jul</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="checkbox" id="inlineCheckbox8" name="tranchDate" value="August">
                        <label class="form-check-label" for="inlineCheckbox8">Aug</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="checkbox" id="inlineCheckbox9" name="tranchDate" value="September">
                        <label class="form-check-label" for="inlineCheckbox9">Sep</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="checkbox" id="inlineCheckbox10" name="tranchDate" value="October">
                        <label class="form-check-label" for="inlineCheckbox10">Oct</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="checkbox" id="inlineCheckbox11" name="tranchDate" value="November">
                        <label class="form-check-label" for="inlineCheckbox11">Nov</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="checkbox" id="inlineCheckbox12" name="tranchDate" value="December">
                        <label class="form-check-label" for="inlineCheckbox12">Dec</label>
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <p class="detailHeading">
                    Cheque to be Issued in favour of
                </p>
                <input type="text" class="form-control" id="txtCheckName" value="@ViewBag.ApplicantName" readonly />
            </div>
            <div class="col-md-8">
                <p class="detailHeading">
                    Comments
                </p>
                <input type="text" class="form-control" id="comments" />
            </div>
        </div>
        <div class="row" style=" margin-top: 30px">

            <div class="col-md-12">
                <p class="detailHeading">
                    Upload Decision Document
                </p>
                <input type="file" id="uploadingFile" />
            </div>
        </div>
        <div class="row" style=" margin-top: 30px">

            <div class="col-md-6" >
                <a id="viewapp" href="/Dashboard/ViewApplication?id=@ViewBag.AppId" target="_blank" class="btn btn-sm btn-outline-primary" title="View Application"><i class="fa fa-search"></i> View Application<span></span></a>
            </div>

            <div class="col-md-6" style="text-align: right; ">
                <a id="recommend" class="btn btn-sm btn-outline-success" title="Submit Decision">Submit Decision<span></span></a>
            </div>

        </div>
    </div>

    <script>

        $('#Decision').on('change', function () {
            var value = this.value;
            if (value == "Decline"  || value == "Discrepent & Represent") {
                $('#reasonDiv').removeClass('d-none');
                $('#approvalDiv').addClass('d-none');
            }
            else if (value == "Approve") {
                $('#approvalDiv').removeClass('d-none');
                $('#reasonDiv').addClass('d-none');
            }
            else if (value == "Discrepent") {
                $('#approvalDiv').removeClass('d-none');
                $('#reasonDiv').removeClass('d-none');
                //$('#reasonDiv').addClass('d-none');
            }
            else {
                $('#approvalDiv').addClass('d-none');
                $('#reasonDiv').addClass('d-none');
            }


        });
        $('#recommend').click(function (e) {
            $(".pageloader").toggleClass("d-none");

            var ApplicationId = $('#ApplicationId').val();
             var McrcId = '@ViewBag.McrcNo';
            var UserId = $('#UserId').val();
            var McrcMember1UserId = $('#Mcrcmember1UserId').val();
            var McrcMember2UserId = $('#Mcrcmember2UserId').val();
            var McrcMember3UserId = $('#Mcrcmember3UserId').val();
            var McrcMember4UserId = $('#Mcrcmember4UserId').val();
            var McrcMember5UserId = $('#Mcrcmember5UserId').val();

            var McrcMember1Recommendation = $('#McrcMember1Recommendation').val();
            var McrcMember2Recommendation = $('#McrcMember2Recommendation').val();
            var McrcMember3Recommendation = $('#McrcMember3Recommendation').val();
            var McrcMember4Recommendation = $('#McrcMember4Recommendation').val();
            var McrcMember5Recommendation = $('#McrcMember5Recommendation').val();

            var McrcMember1Reason = $('#McrcMember1Reason').val();
            var McrcMember2Reason = $('#McrcMember2Reason').val();
            var McrcMember3Reason = $('#McrcMember3Reason').val();
            var McrcMember4Reason = $('#McrcMember4Reason').val();
            var McrcMember5Reason = $('#McrcMember5Reason').val();

            var Decision = $('#Decision').val();
            var Reason = $('#Reason').val();
            var LoanAmount = $('#txtloanAmount').val();
            var LoanTenure = $('#txtloanTenure').val();
            var GraceDays = $('#txtGraceDays').val();
            var AppliedMarkup = $('#txtMarkup').val();
            var CollateralAmount = $('#txtCollateralAmount').val();
            var LTV = $('#txtLTVpercentage').val();
            var CollateralEvaluation = $('#txtCollateralEvaluationDate').val();
            var isDeferment = $('#isDeferment').val();
            var DefermentPeriod = $('#txtDefermentPeriod').val();
            var isTranches = $('#isTranches').val();

            var selected = [];
            $('.form-check input:checked').each(function () {
                selected.push($(this).attr('value'));
            });

            var TranchesDates = selected.join(", ");

            var TranchesAmount = $('#txtTranchesAmounts').val();
            var CheckName = $('#txtCheckName').val();
            var Comments = $('#comments').val();
            var myFile = $('#uploadingFile').prop('files')[0];




            if (ApplicationId == "") {
                abp.notify.error("Application Id not found.");
            }
            else if (McrcMember1Recommendation == "") {
                abp.notify.error("Please select recommendation from "+'@ViewBag.McrcMember1Name'+".");
            }
            else if (McrcMember2Recommendation == "") {
                abp.notify.error("Please select recommendation from "+'@ViewBag.McrcMember2Name'+".");
            }
            else if (McrcMember3Recommendation == "") {
                abp.notify.error("Please select recommendation from "+'@ViewBag.McrcMember3Name'+".");
            }
            else if (McrcMember4Recommendation == "") {
                    abp.notify.error("Please select recommendation from "+'@ViewBag.McrcMember4Name'+".");
            }
            else if (McrcMember5Recommendation == "") {
                abp.notify.error("Please select recommendation from "+'@ViewBag.McrcMember5Name'+".");
            }
            else if (McrcId=="")
            {
                abp.notify.error("Mcrc Id not found.");
            }
            else if (UserId == "") {
                abp.notify.error("User Id not found.");
            }
            else if (Decision=="")
            {
                abp.notify.error("Please Select Decision");
            }
            //else if (Decision == "Approve" && GraceDays == "") {
            //    abp.notify.error("Please Enter Grace Days");
            //}
            else if (Decision == "Approve" && isDeferment=="")
            {
                abp.notify.error("Please Select Deferment Applied");
            }
            else if (Decision == "Approve" && isDeferment=="Yes" && DefermentPeriod == "") {
                abp.notify.error("Please Enter Deferment Period");
            }
            else if (Decision == "Approve" && isTranches == "") {
                abp.notify.error("Please Select Tranches Applied");
            }
            else if (Decision == "Approve" && isTranches == "Yes" &&  TranchesAmount == "") {
                abp.notify.error("Please Enter Tranches Amount");
            }
            else if (Decision == "Approve" && isTranches == "Yes" && TranchesDates == "") {
                abp.notify.error("Please Select Tranches Dates");
            }
            else if (Decision == "Approve" && CheckName == "") {
                abp.notify.error("Please Enter 'CHEQUE TO BE ISSUED IN FAVOUR OF'");
            }
            //else if (myFile == null || myFile == "") {
            //    abp.notify.error("Please Select Document.");
            //}
            else {

                var formData = new FormData();
                formData.append('file', myFile);
                formData.append('ApplicationId', ApplicationId);
                formData.append('UserId', UserId);
                formData.append('McrcId', McrcId);
                formData.append('McrcMember1UserId', McrcMember1UserId);
                formData.append('McrcMember2UserId', McrcMember2UserId);
                formData.append('McrcMember3UserId', McrcMember3UserId);
                formData.append('McrcMember4UserId', McrcMember4UserId);
                formData.append('McrcMember5UserId', McrcMember5UserId);
                formData.append('McrcMember1Recommendation', McrcMember1Recommendation);
                formData.append('McrcMember2Recommendation', McrcMember2Recommendation);
                formData.append('McrcMember3Recommendation', McrcMember3Recommendation);
                formData.append('McrcMember4Recommendation', McrcMember4Recommendation);
                formData.append('McrcMember5Recommendation', McrcMember5Recommendation);
                formData.append('McrcMember1Reason', McrcMember1Reason);
                formData.append('McrcMember2Reason', McrcMember2Reason);
                formData.append('McrcMember3Reason', McrcMember3Reason);
                formData.append('McrcMember4Reason', McrcMember4Reason);
                formData.append('McrcMember5Reason', McrcMember5Reason);
                formData.append('Decision', Decision);
                formData.append('Reason', Reason);
                formData.append('LoanAmount', LoanAmount);
                formData.append('LoanTenure', LoanTenure);
                formData.append('GraceDays', GraceDays);
                formData.append('AppliedMarkup', AppliedMarkup);
                formData.append('CollateralAmount', CollateralAmount);
                formData.append('LTV', LTV);
                formData.append('CollateralEvaluation', CollateralEvaluation);
                formData.append('isDeferment', isDeferment);
                formData.append('DefermentPeriod', DefermentPeriod);
                formData.append('TranchesDates', TranchesDates);
                formData.append('TranchesAmount', TranchesAmount);
                formData.append('CheckName', CheckName);
                formData.append('Comments', Comments);
                formData.append('isTranches', isTranches);

                 $.ajax({
                    type: 'POST',
                    datatype: "json",
                     processData: false,
                     contentType: false,
                    url: '@Url.Content("~/Mcrc/CreateMcrcDecision")',
                     data: formData,
                     success: function (data) {

                         var returnData = data.result;
                         abp.notify.success(returnData, "Success");
                         window.location.reload();

                    },
                    error: function (data) {

                        abp.notify.error("Some error occure contact with admin..!", "error");
                        console.log(data);
                    }
                });
            }
        });
    </script>

</body>
</html>
